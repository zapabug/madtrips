(()=>{var e={};e.id=20,e.ids=[20],e.modules={440:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(1658);let a=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,s.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},877:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,pages:()=>d,routeModule:()=>p,tree:()=>c});var s=r(5239),a=r(8088),n=r(8170),i=r.n(n),o=r(893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c={children:["",{children:["packages",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,9902)),"/home/lfg/Git/Madtrips/src/app/packages/[id]/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,4431)),"/home/lfg/Git/Madtrips/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/home/lfg/Git/Madtrips/src/app/packages/[id]/page.tsx"],m={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/packages/[id]/page",pathname:"/packages/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1820:e=>{"use strict";e.exports=require("os")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3100:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var s=r(687),a=r(3210),n=r(474),i=r(5814),o=r.n(i),l=r(6189),c=r(2102),d=r(8464),m=r(4385);let p=async(e,t)=>{try{let r=await fetch("/api/payments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,description:t})}),s=await r.json();if(!r.ok)throw Error(s.message||"Failed to create payment");return s}catch(e){throw console.error("Error creating payment:",e),e}},h=async e=>{try{let t=await fetch("/api/bookings/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw Error(r.message||"Failed to create booking");return r}catch(e){throw console.error("Error creating booking:",e),e}};function u(){(0,l.useParams)().id;let[e,t]=(0,a.useState)(null),[r,i]=(0,a.useState)(!0),[u,x]=(0,a.useState)(null),[g,y]=(0,a.useState)(!1),[b,f]=(0,a.useState)(!1),[w,k]=(0,a.useState)(null),[v,j]=(0,a.useState)(!1),[N,P]=(0,a.useState)(null),{user:E,loginMethod:C}=(0,c.yX)(),S=async t=>{if(t.preventDefault(),e){if(!E){x("Please connect your Nostr wallet to continue with payment.");return}try{let t=await p(e.price,`MadTrips: ${e.title}`);k(t),f(!0)}catch(e){console.error("Error generating payment:",e),x("Failed to generate payment. Please try again.")}}},M=async t=>{if(e&&E&&w)try{let r=await h({packageId:e.id,nostrPubkey:E.npub,invoice:w.invoice,preimage:t});P(r.bookingId),j(!0),f(!1)}catch(e){console.error("Error creating booking:",e),x("Payment confirmed, but booking creation failed. Please contact support.")}};return r?(0,s.jsx)("div",{className:"container mx-auto px-4 py-12 flex items-center justify-center h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#F7931A]"})}):u||!e?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-12",children:[(0,s.jsx)("div",{className:"bg-red-50 p-4 rounded-md border border-red-200 text-red-700",children:u||"Package not found"}),(0,s.jsx)(o(),{href:"/packages",className:"mt-4 inline-block text-[#F7931A] hover:underline",children:"← Back to packages"})]}):(0,s.jsxs)("div",{className:"container mx-auto px-4 py-12",children:[(0,s.jsx)(o(),{href:"/packages",className:"inline-block mb-8 text-[#F7931A] hover:underline",children:"← Back to packages"}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"relative h-96 w-full",children:(0,s.jsx)(n.default,{src:e.image||"/assets/placeholder.jpg",alt:e.title,fill:!0,className:"object-cover"})}),(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-4 text-ocean dark:text-[#F7931A]",children:e.title}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-lg mb-6",children:e.description}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-3 text-gray-800 dark:text-white",children:"Package Details"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:[(0,s.jsx)("span",{className:"font-medium",children:"Duration:"})," ",e.duration]}),(0,s.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:[(0,s.jsx)("span",{className:"font-medium",children:"Price:"})," ",(0,s.jsx)("span",{className:"text-[#F7931A] font-semibold",children:(0,m.xX)(e.price)})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-3 text-gray-800 dark:text-white",children:"What's Included"}),(0,s.jsx)("ul",{className:"list-disc pl-5 text-gray-600 dark:text-gray-400 space-y-1",children:e.includes.map((e,t)=>(0,s.jsx)("li",{children:e},t))})]})]}),!g&&!v&&(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("button",{onClick:()=>{y(!0)},className:"px-8 py-3 bg-[#F7931A] hover:bg-[#F7931A]/80 text-white rounded-md font-semibold transition-colors",children:"Book Now with Bitcoin"})}),g&&!w&&!v&&!b&&(0,s.jsxs)("div",{className:"mt-8 max-w-md mx-auto",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-white",children:"Ready to Book"}),u&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-100 rounded",children:(0,s.jsx)("p",{children:u})}),E?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Connected with Nostr pubkey:"}),(0,s.jsx)("p",{className:"font-mono text-xs break-all",children:E.npub}),(0,s.jsxs)("div",{className:"mt-2 flex items-center text-green-600",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,s.jsxs)("span",{className:"text-xs",children:["Connected with ","nip07"===C?"Browser Extension":"nip47"===C?"Remote Signer":"View Only"]})]})]}),(0,s.jsxs)("div",{className:"pt-4",children:[(0,s.jsx)("button",{onClick:S,disabled:"viewonly"===C,className:"w-full px-4 py-2 bg-[#F7931A] hover:bg-[#F7931A]/80 text-white rounded-md font-semibold transition-colors disabled:opacity-50",children:"Proceed to Payment"}),"viewonly"===C&&(0,s.jsx)("p",{className:"mt-2 text-sm text-yellow-600 dark:text-yellow-400",children:"You are in view-only mode. Please connect with a signing method to make payments."})]})]}):(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Please connect your Nostr wallet to continue with payment."}),(0,s.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800 mb-4",children:(0,s.jsx)("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:"Use the Nostr login button in the bottom right corner to connect."})})]})]}),b&&w&&!v&&(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsx)(d.T,{invoice:w.invoice,amount:(0,m.xX)(e.price),description:`MadTrips: ${e.title}`,onSuccess:M,onError:e=>{x(`Payment failed: ${e.message}`),f(!1)},onCancel:()=>{f(!1)}})}),w&&!v&&!b&&(0,s.jsxs)("div",{className:"mt-8 max-w-md mx-auto text-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-white",children:"Pay with Bitcoin"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Scan the QR code with your Lightning wallet to complete payment."}),(0,s.jsx)("div",{className:"bg-white p-4 rounded-lg inline-block mb-4",children:(0,s.jsx)(n.default,{src:w.qrCode,alt:"Lightning Invoice QR Code",width:250,height:250})}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 break-all mb-4",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Lightning Invoice:"}),(0,s.jsxs)("code",{className:"bg-gray-100 dark:bg-gray-700 p-2 rounded block",children:[w.invoice.substring(0,30),"..."]})]}),(0,s.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:[(0,s.jsx)("span",{className:"text-[#F7931A] font-semibold",children:"Note:"}),' This is a demo payment. In the MVP version, the payment will be automatically "confirmed" after 5 seconds.']})]}),v&&N&&(0,s.jsx)("div",{className:"mt-8 max-w-md mx-auto text-center",children:(0,s.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 p-6 rounded-lg border border-green-200 dark:border-green-800",children:[(0,s.jsx)("svg",{className:"w-16 h-16 text-green-500 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-2",children:"Booking Confirmed!"}),(0,s.jsxs)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["Thank you for your booking. Your confirmation ID is: ",(0,s.jsx)("span",{className:"font-mono font-medium",children:N})]}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"You will receive a confirmation email shortly with all the details of your trip."}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(o(),{href:"/packages",className:"px-6 py-2 bg-[#F7931A] hover:bg-[#F7931A]/80 text-white rounded-md font-medium transition-colors",children:"Browse More Packages"})})]})})]})]})]})}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},3997:e=>{"use strict";e.exports=require("tty")},4385:(e,t,r)=>{"use strict";r.d(t,{$f:()=>i,K_:()=>s,pO:()=>n,xX:()=>a});let s=[{id:"1",title:"Beach Day Experience",description:"Enjoy a day at Madeira's most beautiful beaches with transportation included.",price:1,duration:"1 Day",includes:["Transportation","Lunch","Beach Equipment"],image:"/assets/packages/beach-day.jpg"},{id:"2",title:"Mountain Explorer",description:"Discover the stunning mountains and levadas of Madeira with expert guides.",price:2,duration:"2 Days",includes:["Transportation","Accommodation","Meals","Guided Tours"],image:"/assets/packages/mountains.jpg"},{id:"3",title:"Bitcoin Conference Package",description:"All-inclusive package for the annual Bitcoin Madeira Conference.",price:3,duration:"3 Days",includes:["Conference Entry","Accommodation","Meals","Networking Events"],image:"/assets/packages/conference.jpg"},{id:"4",title:"Porto Santo Getaway",description:"Experience the golden beaches of Porto Santo island with this all-inclusive package.",price:4,duration:"3 Days",includes:["Ferry Transportation","Beach Hotel","Meals","Island Tour"],image:"/assets/packages/porto-santo.jpg"},{id:"5",title:"Madeira Food Tour",description:"Taste the unique flavors of Madeira with this guided food tour around the island.",price:5,duration:"1 Day",includes:["Multiple Food Tastings","Wine Tasting","Expert Guide","Transportation"],image:"/assets/packages/food-tour.jpg"},{id:"6",title:"Hiking Adventure",description:"Explore Madeira's most breathtaking trails with experienced local guides.",price:6,duration:"2 Days",includes:["Trail Access","Safety Equipment","Meals","Transportation"],image:"/assets/packages/hiking.jpg"}],a=(e,t=!1)=>`${e} sats`,n=s.slice(0,4),i=e=>s.find(t=>t.id===e)},5511:e=>{"use strict";e.exports=require("crypto")},5838:(e,t,r)=>{Promise.resolve().then(r.bind(r,9902))},7598:e=>{"use strict";e.exports=require("node:crypto")},8354:e=>{"use strict";e.exports=require("util")},8464:(e,t,r)=>{"use strict";r.d(t,{T:()=>m});var s=r(687),a=r(3210),n=r(2102),i=r(1158),o=r(2994);class l{constructor(e){this.client=null,this.paymentSubscription=null,this.pendingPayments=new Map,this.ndk=e}async connect(e,t){try{await this.disconnect(),this.client=new i.M(e,t),await this.client.connect(),await this.setupPaymentResponseSubscription(),console.log("Payment service connected to wallet")}catch(e){throw console.error("Failed to connect payment service:",e),this.client=null,e}}async setupPaymentResponseSubscription(){if(!this.client||!this.ndk)throw Error("Client or NDK not initialized");let e=this.client.getPublicKey?await this.client.getPublicKey():"";this.paymentSubscription=this.ndk.subscribe({kinds:[24133],"#p":[e]},{closeOnEose:!1}),this.paymentSubscription.on("event",async e=>{try{if(!this.client)return;let t=e.rawEvent();if(!t||"number"!=typeof t.kind){console.error("Invalid event received");return}let r=await this.client.processPaymentResponse(t);if(r&&r.id&&this.pendingPayments.has(r.id)){let e=this.pendingPayments.get(r.id);r.error?e.reject(Error(`Payment error: ${r.error.message}`)):r.result?e.resolve(r.result):e.reject(Error("Invalid payment response")),this.pendingPayments.delete(r.id)}}catch(e){console.error("Failed to process payment response event:",e)}}),console.log("Payment response subscription set up")}isConnected(){return null!==this.client}async getWalletInfo(){if(!this.client)throw Error("Not connected to a wallet");return await this.client.getInfo()}async getBalance(){if(!this.client)throw Error("Not connected to a wallet");return await this.client.getBalance()}async payInvoice(e){if(!this.client)throw Error("Not connected to a wallet");return await this.client.payInvoice(e)}async processPaymentEvent(e){if(!this.client||!this.ndk)throw Error("Not connected to a wallet");try{let t=await this.client.createPaymentRequestEvent(e),r=new Promise((r,s)=>{if(!t.id){s(Error("Invalid payment request event"));return}this.pendingPayments.set(t.id,{resolve:r,reject:s,invoice:e}),setTimeout(()=>{t.id&&this.pendingPayments.has(t.id)&&(this.pendingPayments.delete(t.id),s(Error("Payment timeout")))},6e4)}),s=new o.QB(this.ndk);return t.kind&&(s.kind=t.kind),s.tags=t.tags||[],s.content=t.content||"",s.created_at=t.created_at||Math.floor(Date.now()/1e3),await s.publish(),console.log("Payment request published, waiting for response..."),await r}catch(e){throw console.error("Failed to process payment:",e),e}}async disconnect(){for(let[e,{reject:t}]of(this.paymentSubscription&&(this.paymentSubscription.stop(),this.paymentSubscription=null),this.client&&(this.client.disconnect(),this.client=null),this.pendingPayments))t(Error("Disconnected from wallet")),this.pendingPayments.delete(e);console.log("Payment service disconnected")}}let c=null,d=e=>(c||(c=new l(e)),c),m=({invoice:e,amount:t,description:r,onSuccess:i,onError:o,onCancel:l})=>{let{ndk:c,user:m,loginMethod:p}=(0,n.yX)(),[h,u]=(0,a.useState)("idle"),[x,g]=(0,a.useState)(null),[y,b]=(0,a.useState)(null),[f,w]=(0,a.useState)(!1),k="nip47"===p;(0,a.useEffect)(()=>{u("idle"),g(null),b(null)},[e]);let v=async()=>{if(!c||!m){g("You must be logged in to make a payment");return}try{if(u("connecting"),d(c),k||"nip07"===p){w(!0),u("idle");return}if("viewonly"===p)throw Error("Cannot make payments in view-only mode");throw Error("No compatible payment method detected")}catch(e){console.error("Failed to connect wallet:",e),g(e instanceof Error?e.message:"Failed to connect wallet"),u("error")}},j=async()=>{if(!c||!m){g("You must be logged in to make a payment");return}try{u("paying");let t=d(c);if(k){let r=await t.payInvoice(e);b(r.preimage),u("success"),i?.(r.preimage)}else if("nip07"===p)throw Error("Your browser extension does not support WebLN for payments");else throw Error("No compatible payment method detected")}catch(e){console.error("Payment failed:",e),g(e instanceof Error?e.message:"Payment failed"),u("error"),o?.(e instanceof Error?e:Error("Payment failed"))}};return(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 max-w-md mx-auto",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3 text-center dark:text-white",children:"Lightning Payment"}),(0,s.jsxs)("div",{className:"mb-4 text-center",children:[(0,s.jsxs)("p",{className:"text-2xl font-bold dark:text-white",children:[t," sats"]}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:r})]}),"error"===h&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-100 rounded",children:(0,s.jsx)("p",{children:x})}),"success"===h&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-100 rounded",children:[(0,s.jsx)("p",{children:"Payment successful!"}),y&&(0,s.jsxs)("details",{className:"mt-2",children:[(0,s.jsx)("summary",{className:"cursor-pointer",children:"Payment Proof"}),(0,s.jsx)("p",{className:"text-xs mt-1 break-all",children:y})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[f||"success"===h?"success"!==h?(0,s.jsx)("button",{onClick:j,disabled:"paying"===h,className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm font-medium flex items-center justify-center disabled:opacity-50",children:"paying"===h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"mr-2 animate-spin",children:"⚡"}),"Paying..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"mr-2",children:"⚡"}),"Pay with Nostr"]})}):null:(0,s.jsx)("button",{onClick:v,disabled:"connecting"===h,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium flex items-center justify-center disabled:opacity-50",children:"connecting"===h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"mr-2 animate-spin",children:"⚡"}),"Connecting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"mr-2",children:"⚡"}),"Connect Wallet"]})}),("idle"===h||"error"===h)&&(0,s.jsx)("button",{onClick:()=>{u("idle"),g(null),l?.()},className:"w-full px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-md text-sm font-medium",children:"Cancel"}),"success"===h&&(0,s.jsx)("button",{onClick:()=>{u("idle"),b(null)},className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium",children:"Done"})]}),(0,s.jsx)("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400 text-center",children:"Powered by Nostr + Lightning"})]})}},8886:(e,t,r)=>{Promise.resolve().then(r.bind(r,3100))},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")},9902:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/lfg/Git/Madtrips/src/app/packages/[id]/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/lfg/Git/Madtrips/src/app/packages/[id]/page.tsx","default")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,488,658,587],()=>r(877));module.exports=s})();