(()=>{var e={};e.id=88,e.ids=[88],e.modules={440:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(1658);let s=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,n.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1054:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});let n=(0,r(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/lfg/Git/Madtrips/src/app/payment-example/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/lfg/Git/Madtrips/src/app/payment-example/page.tsx","default")},1820:e=>{"use strict";e.exports=require("os")},2402:(e,t,r)=>{Promise.resolve().then(r.bind(r,1054))},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},3997:e=>{"use strict";e.exports=require("tty")},4251:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(687),s=r(3210),a=r(2102),i=r(8464);function o(){let{user:e,loginMethod:t}=(0,a.yX)(),[r,o]=(0,s.useState)(""),[l,d]=(0,s.useState)("1000"),[c,m]=(0,s.useState)("Test Payment"),[p,u]=(0,s.useState)(!1),[h,g]=(0,s.useState)(null),x=()=>{let e="lnbc10m1pvjluezpp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqdpl2pkx2ctnv5sxxmmwwd5kgetjypeh2ursdae8g6twvus8g6rfwvs8qun0dfjkxaqnqsfcq0d4jq3n3q0jaunt4qz7zs0gyaqyfz8yrtfd6cm9a3t3kxzwfjuj3hxxecpda9qxdhp8p0nyumz2vzjzle60e4g9ekrdffr9znscdhvugz";return o(e),e};return(0,n.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Nostr Payment Example"}),e?"viewonly"===t?(0,n.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900 border border-yellow-400 dark:border-yellow-700 text-yellow-800 dark:text-yellow-100 p-4 rounded mb-6",children:[(0,n.jsx)("p",{className:"font-medium",children:"You are in view-only mode."}),(0,n.jsx)("p",{className:"text-sm mt-2",children:"Please log in with a NIP-07 extension or NIP-47 remote signer to test payments."})]}):(0,n.jsxs)("div",{className:"bg-green-100 dark:bg-green-900 border border-green-400 dark:border-green-700 text-green-800 dark:text-green-100 p-4 rounded mb-6",children:[(0,n.jsxs)("p",{className:"font-medium",children:["You are logged in with ","nip07"===t?"a browser extension":"a remote signer","."]}),(0,n.jsx)("p",{className:"text-sm mt-2",children:"You can now test the payment functionality."})]}):(0,n.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900 border border-yellow-400 dark:border-yellow-700 text-yellow-800 dark:text-yellow-100 p-4 rounded mb-6",children:[(0,n.jsx)("p",{className:"font-medium",children:"Please log in to test the payment functionality."}),(0,n.jsx)("p",{className:"text-sm mt-2",children:"Use the Nostr login button in the bottom right corner."})]}),(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Payment Configuration"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount (sats)"}),(0,n.jsx)("input",{type:"number",id:"amount",value:l,onChange:e=>d(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"Enter amount in satoshis"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),(0,n.jsx)("input",{type:"text",id:"description",value:c,onChange:e=>m(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"Enter payment description"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"invoice",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Lightning Invoice (optional)"}),(0,n.jsx)("textarea",{id:"invoice",value:r,onChange:e=>o(e.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"Enter a Lightning invoice or leave empty to generate a demo one"}),(0,n.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"If left empty, a fake invoice will be generated for demonstration."})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{onClick:()=>{r||x(),u(!0),g(null)},disabled:!e||"viewonly"===t,className:"w-full px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Start Payment Demo"})})]})]}),h&&(0,n.jsx)("div",{className:`mb-6 p-4 rounded ${h.includes("failed")?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-100":"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100"}`,children:(0,n.jsx)("p",{children:h})}),p&&(0,n.jsx)("div",{className:"mt-8",children:(0,n.jsx)(i.T,{invoice:r,amount:l,description:c,onSuccess:e=>{console.log("Payment successful with preimage:",e),g(`Payment successful! Preimage: ${e.substring(0,8)}...`)},onError:e=>{console.error("Payment failed:",e),g(`Payment failed: ${e.message}`)},onCancel:()=>{console.log("Payment cancelled"),u(!1)}})}),(0,n.jsxs)("div",{className:"mt-8 bg-gray-100 dark:bg-gray-700 p-4 rounded-lg",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-2",children:"How It Works"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"This example demonstrates how to integrate Nostr-based Lightning payments into your application:"}),(0,n.jsxs)("ol",{className:"list-decimal list-inside text-sm text-gray-600 dark:text-gray-300 space-y-1 ml-2",children:[(0,n.jsx)("li",{children:"User logs in with a Nostr wallet (NIP-07 extension or NIP-47 remote signer)"}),(0,n.jsx)("li",{children:"Application generates a Lightning invoice"}),(0,n.jsx)("li",{children:"Payment component connects to the user's wallet"}),(0,n.jsx)("li",{children:"User confirms the payment in their wallet"}),(0,n.jsx)("li",{children:"Application verifies the payment and updates the UI"})]}),(0,n.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-4",children:"In a real application, you would integrate with a Lightning service to generate valid invoices and verify payments."})]})]})}},5511:e=>{"use strict";e.exports=require("crypto")},5962:(e,t,r)=>{Promise.resolve().then(r.bind(r,4251))},7598:e=>{"use strict";e.exports=require("node:crypto")},8354:e=>{"use strict";e.exports=require("util")},8464:(e,t,r)=>{"use strict";r.d(t,{T:()=>m});var n=r(687),s=r(3210),a=r(2102),i=r(1158),o=r(2994);class l{constructor(e){this.client=null,this.paymentSubscription=null,this.pendingPayments=new Map,this.ndk=e}async connect(e,t){try{await this.disconnect(),this.client=new i.M(e,t),await this.client.connect(),await this.setupPaymentResponseSubscription(),console.log("Payment service connected to wallet")}catch(e){throw console.error("Failed to connect payment service:",e),this.client=null,e}}async setupPaymentResponseSubscription(){if(!this.client||!this.ndk)throw Error("Client or NDK not initialized");let e=this.client.getPublicKey?await this.client.getPublicKey():"";this.paymentSubscription=this.ndk.subscribe({kinds:[24133],"#p":[e]},{closeOnEose:!1}),this.paymentSubscription.on("event",async e=>{try{if(!this.client)return;let t=e.rawEvent();if(!t||"number"!=typeof t.kind){console.error("Invalid event received");return}let r=await this.client.processPaymentResponse(t);if(r&&r.id&&this.pendingPayments.has(r.id)){let e=this.pendingPayments.get(r.id);r.error?e.reject(Error(`Payment error: ${r.error.message}`)):r.result?e.resolve(r.result):e.reject(Error("Invalid payment response")),this.pendingPayments.delete(r.id)}}catch(e){console.error("Failed to process payment response event:",e)}}),console.log("Payment response subscription set up")}isConnected(){return null!==this.client}async getWalletInfo(){if(!this.client)throw Error("Not connected to a wallet");return await this.client.getInfo()}async getBalance(){if(!this.client)throw Error("Not connected to a wallet");return await this.client.getBalance()}async payInvoice(e){if(!this.client)throw Error("Not connected to a wallet");return await this.client.payInvoice(e)}async processPaymentEvent(e){if(!this.client||!this.ndk)throw Error("Not connected to a wallet");try{let t=await this.client.createPaymentRequestEvent(e),r=new Promise((r,n)=>{if(!t.id){n(Error("Invalid payment request event"));return}this.pendingPayments.set(t.id,{resolve:r,reject:n,invoice:e}),setTimeout(()=>{t.id&&this.pendingPayments.has(t.id)&&(this.pendingPayments.delete(t.id),n(Error("Payment timeout")))},6e4)}),n=new o.QB(this.ndk);return t.kind&&(n.kind=t.kind),n.tags=t.tags||[],n.content=t.content||"",n.created_at=t.created_at||Math.floor(Date.now()/1e3),await n.publish(),console.log("Payment request published, waiting for response..."),await r}catch(e){throw console.error("Failed to process payment:",e),e}}async disconnect(){for(let[e,{reject:t}]of(this.paymentSubscription&&(this.paymentSubscription.stop(),this.paymentSubscription=null),this.client&&(this.client.disconnect(),this.client=null),this.pendingPayments))t(Error("Disconnected from wallet")),this.pendingPayments.delete(e);console.log("Payment service disconnected")}}let d=null,c=e=>(d||(d=new l(e)),d),m=({invoice:e,amount:t,description:r,onSuccess:i,onError:o,onCancel:l})=>{let{ndk:d,user:m,loginMethod:p}=(0,a.yX)(),[u,h]=(0,s.useState)("idle"),[g,x]=(0,s.useState)(null),[y,b]=(0,s.useState)(null),[f,w]=(0,s.useState)(!1),v="nip47"===p;(0,s.useEffect)(()=>{h("idle"),x(null),b(null)},[e]);let j=async()=>{if(!d||!m){x("You must be logged in to make a payment");return}try{if(h("connecting"),c(d),v||"nip07"===p){w(!0),h("idle");return}if("viewonly"===p)throw Error("Cannot make payments in view-only mode");throw Error("No compatible payment method detected")}catch(e){console.error("Failed to connect wallet:",e),x(e instanceof Error?e.message:"Failed to connect wallet"),h("error")}},k=async()=>{if(!d||!m){x("You must be logged in to make a payment");return}try{h("paying");let t=c(d);if(v){let r=await t.payInvoice(e);b(r.preimage),h("success"),i?.(r.preimage)}else if("nip07"===p)throw Error("Your browser extension does not support WebLN for payments");else throw Error("No compatible payment method detected")}catch(e){console.error("Payment failed:",e),x(e instanceof Error?e.message:"Payment failed"),h("error"),o?.(e instanceof Error?e:Error("Payment failed"))}};return(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 max-w-md mx-auto",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-3 text-center dark:text-white",children:"Lightning Payment"}),(0,n.jsxs)("div",{className:"mb-4 text-center",children:[(0,n.jsxs)("p",{className:"text-2xl font-bold dark:text-white",children:[t," sats"]}),(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:r})]}),"error"===u&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-100 rounded",children:(0,n.jsx)("p",{children:g})}),"success"===u&&(0,n.jsxs)("div",{className:"mb-4 p-3 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-100 rounded",children:[(0,n.jsx)("p",{children:"Payment successful!"}),y&&(0,n.jsxs)("details",{className:"mt-2",children:[(0,n.jsx)("summary",{className:"cursor-pointer",children:"Payment Proof"}),(0,n.jsx)("p",{className:"text-xs mt-1 break-all",children:y})]})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[f||"success"===u?"success"!==u?(0,n.jsx)("button",{onClick:k,disabled:"paying"===u,className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm font-medium flex items-center justify-center disabled:opacity-50",children:"paying"===u?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"mr-2 animate-spin",children:"⚡"}),"Paying..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"mr-2",children:"⚡"}),"Pay with Nostr"]})}):null:(0,n.jsx)("button",{onClick:j,disabled:"connecting"===u,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium flex items-center justify-center disabled:opacity-50",children:"connecting"===u?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"mr-2 animate-spin",children:"⚡"}),"Connecting..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"mr-2",children:"⚡"}),"Connect Wallet"]})}),("idle"===u||"error"===u)&&(0,n.jsx)("button",{onClick:()=>{h("idle"),x(null),l?.()},className:"w-full px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-md text-sm font-medium",children:"Cancel"}),"success"===u&&(0,n.jsx)("button",{onClick:()=>{h("idle"),b(null)},className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium",children:"Done"})]}),(0,n.jsx)("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400 text-center",children:"Powered by Nostr + Lightning"})]})}},8821:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d});var n=r(5239),s=r(8088),a=r(8170),i=r.n(a),o=r(893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let d={children:["",{children:["payment-example",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,1054)),"/home/lfg/Git/Madtrips/src/app/payment-example/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,4431)),"/home/lfg/Git/Madtrips/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/home/lfg/Git/Madtrips/src/app/payment-example/page.tsx"],m={require:r,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/payment-example/page",pathname:"/payment-example",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[447,488,658,587],()=>r(8821));module.exports=n})();