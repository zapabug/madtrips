(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[20],{2239:(e,t,a)=>{"use strict";a.d(t,{$f:()=>i,K_:()=>n,pO:()=>r,xX:()=>s});let n=[{id:"1",title:"Beach Day Experience",description:"Enjoy a day at Madeira's most beautiful beaches with transportation included.",price:1,duration:"1 Day",includes:["Transportation","Lunch","Beach Equipment"],image:"/assets/packages/beach-day.jpg"},{id:"2",title:"Mountain Explorer",description:"Discover the stunning mountains and levadas of Madeira with expert guides.",price:2,duration:"2 Days",includes:["Transportation","Accommodation","Meals","Guided Tours"],image:"/assets/packages/mountains.jpg"},{id:"3",title:"Bitcoin Conference Package",description:"All-inclusive package for the annual Bitcoin Madeira Conference.",price:3,duration:"3 Days",includes:["Conference Entry","Accommodation","Meals","Networking Events"],image:"/assets/packages/conference.jpg"},{id:"4",title:"Porto Santo Getaway",description:"Experience the golden beaches of Porto Santo island with this all-inclusive package.",price:4,duration:"3 Days",includes:["Ferry Transportation","Beach Hotel","Meals","Island Tour"],image:"/assets/packages/porto-santo.jpg"},{id:"5",title:"Madeira Food Tour",description:"Taste the unique flavors of Madeira with this guided food tour around the island.",price:5,duration:"1 Day",includes:["Multiple Food Tastings","Wine Tasting","Expert Guide","Transportation"],image:"/assets/packages/food-tour.jpg"},{id:"6",title:"Hiking Adventure",description:"Explore Madeira's most breathtaking trails with experienced local guides.",price:6,duration:"2 Days",includes:["Trail Access","Safety Equipment","Meals","Transportation"],image:"/assets/packages/hiking.jpg"}],s=function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],"".concat(e," sats")},r=n.slice(0,4),i=e=>n.find(t=>t.id===e)},2910:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var n=a(5155),s=a(2115),r=a(6766),i=a(6874),o=a.n(i),l=a(5695),c=a(6298),d=a(5924),m=a(2239);let h=async(e,t)=>{try{let a=await fetch("/api/payments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,description:t})}),n=await a.json();if(!a.ok)throw Error(n.message||"Failed to create payment");return n}catch(e){throw console.error("Error creating payment:",e),e}},u=async e=>{try{let t=await fetch("/api/bookings/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error(a.message||"Failed to create booking");return a}catch(e){throw console.error("Error creating booking:",e),e}};function p(){let e=(0,l.useParams)().id,[t,a]=(0,s.useState)(null),[i,p]=(0,s.useState)(!0),[x,g]=(0,s.useState)(null),[y,b]=(0,s.useState)(!1),[w,f]=(0,s.useState)(!1),[k,j]=(0,s.useState)(null),[N,v]=(0,s.useState)(!1),[P,E]=(0,s.useState)(null),{user:S,loginMethod:C}=(0,c.yX)();(0,s.useEffect)(()=>{(()=>{if(p(!0),!e){g("Invalid package ID"),p(!1);return}let t=(0,m.$f)(e);t?(a(t),g(null)):g("Package not found"),p(!1)})()},[e]);let F=async e=>{if(e.preventDefault(),t){if(!S){g("Please connect your Nostr wallet to continue with payment.");return}try{let e=await h(t.price,"MadTrips: ".concat(t.title));j(e),f(!0)}catch(e){console.error("Error generating payment:",e),g("Failed to generate payment. Please try again.")}}},T=async e=>{if(t&&S&&k)try{let a=await u({packageId:t.id,nostrPubkey:S.npub,invoice:k.invoice,preimage:e});E(a.bookingId),v(!0),f(!1)}catch(e){console.error("Error creating booking:",e),g("Payment confirmed, but booking creation failed. Please contact support.")}};return i?(0,n.jsx)("div",{className:"container mx-auto px-4 py-12 flex items-center justify-center h-screen",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#F7931A]"})}):x||!t?(0,n.jsxs)("div",{className:"container mx-auto px-4 py-12",children:[(0,n.jsx)("div",{className:"bg-red-50 p-4 rounded-md border border-red-200 text-red-700",children:x||"Package not found"}),(0,n.jsx)(o(),{href:"/packages",className:"mt-4 inline-block text-[#F7931A] hover:underline",children:"← Back to packages"})]}):(0,n.jsxs)("div",{className:"container mx-auto px-4 py-12",children:[(0,n.jsx)(o(),{href:"/packages",className:"inline-block mb-8 text-[#F7931A] hover:underline",children:"← Back to packages"}),(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,n.jsx)("div",{className:"relative h-96 w-full",children:(0,n.jsx)(r.default,{src:t.image||"/assets/placeholder.jpg",alt:t.title,fill:!0,className:"object-cover"})}),(0,n.jsxs)("div",{className:"p-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-4 text-ocean dark:text-[#F7931A]",children:t.title}),(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-lg mb-6",children:t.description}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-3 text-gray-800 dark:text-white",children:"Package Details"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:[(0,n.jsx)("span",{className:"font-medium",children:"Duration:"})," ",t.duration]}),(0,n.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:[(0,n.jsx)("span",{className:"font-medium",children:"Price:"})," ",(0,n.jsx)("span",{className:"text-[#F7931A] font-semibold",children:(0,m.xX)(t.price)})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-3 text-gray-800 dark:text-white",children:"What's Included"}),(0,n.jsx)("ul",{className:"list-disc pl-5 text-gray-600 dark:text-gray-400 space-y-1",children:t.includes.map((e,t)=>(0,n.jsx)("li",{children:e},t))})]})]}),!y&&!N&&(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)("button",{onClick:()=>{b(!0)},className:"px-8 py-3 bg-[#F7931A] hover:bg-[#F7931A]/80 text-white rounded-md font-semibold transition-colors",children:"Book Now with Bitcoin"})}),y&&!k&&!N&&!w&&(0,n.jsxs)("div",{className:"mt-8 max-w-md mx-auto",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-white",children:"Ready to Book"}),x&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-100 rounded",children:(0,n.jsx)("p",{children:x})}),S?(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Connected with Nostr pubkey:"}),(0,n.jsx)("p",{className:"font-mono text-xs break-all",children:S.npub}),(0,n.jsxs)("div",{className:"mt-2 flex items-center text-green-600",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,n.jsxs)("span",{className:"text-xs",children:["Connected with ","nip07"===C?"Browser Extension":"nip47"===C?"Remote Signer":"View Only"]})]})]}),(0,n.jsxs)("div",{className:"pt-4",children:[(0,n.jsx)("button",{onClick:F,disabled:"viewonly"===C,className:"w-full px-4 py-2 bg-[#F7931A] hover:bg-[#F7931A]/80 text-white rounded-md font-semibold transition-colors disabled:opacity-50",children:"Proceed to Payment"}),"viewonly"===C&&(0,n.jsx)("p",{className:"mt-2 text-sm text-yellow-600 dark:text-yellow-400",children:"You are in view-only mode. Please connect with a signing method to make payments."})]})]}):(0,n.jsxs)("div",{className:"text-center mb-6",children:[(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Please connect your Nostr wallet to continue with payment."}),(0,n.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800 mb-4",children:(0,n.jsx)("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:"Use the Nostr login button in the bottom right corner to connect."})})]})]}),w&&k&&!N&&(0,n.jsx)("div",{className:"mt-8",children:(0,n.jsx)(d.T,{invoice:k.invoice,amount:(0,m.xX)(t.price),description:"MadTrips: ".concat(t.title),onSuccess:T,onError:e=>{g("Payment failed: ".concat(e.message)),f(!1)},onCancel:()=>{f(!1)}})}),k&&!N&&!w&&(0,n.jsxs)("div",{className:"mt-8 max-w-md mx-auto text-center",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-white",children:"Pay with Bitcoin"}),(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Scan the QR code with your Lightning wallet to complete payment."}),(0,n.jsx)("div",{className:"bg-white p-4 rounded-lg inline-block mb-4",children:(0,n.jsx)(r.default,{src:k.qrCode,alt:"Lightning Invoice QR Code",width:250,height:250})}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 break-all mb-4",children:[(0,n.jsx)("p",{className:"font-medium mb-1",children:"Lightning Invoice:"}),(0,n.jsxs)("code",{className:"bg-gray-100 dark:bg-gray-700 p-2 rounded block",children:[k.invoice.substring(0,30),"..."]})]}),(0,n.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:[(0,n.jsx)("span",{className:"text-[#F7931A] font-semibold",children:"Note:"}),' This is a demo payment. In the MVP version, the payment will be automatically "confirmed" after 5 seconds.']})]}),N&&P&&(0,n.jsx)("div",{className:"mt-8 max-w-md mx-auto text-center",children:(0,n.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 p-6 rounded-lg border border-green-200 dark:border-green-800",children:[(0,n.jsx)("svg",{className:"w-16 h-16 text-green-500 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-2",children:"Booking Confirmed!"}),(0,n.jsxs)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["Thank you for your booking. Your confirmation ID is: ",(0,n.jsx)("span",{className:"font-mono font-medium",children:P})]}),(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"You will receive a confirmation email shortly with all the details of your trip."}),(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsx)(o(),{href:"/packages",className:"px-6 py-2 bg-[#F7931A] hover:bg-[#F7931A]/80 text-white rounded-md font-medium transition-colors",children:"Browse More Packages"})})]})})]})]})]})}},5250:(e,t,a)=>{Promise.resolve().then(a.bind(a,2910))},5695:(e,t,a)=>{"use strict";var n=a(8999);a.o(n,"useParams")&&a.d(t,{useParams:function(){return n.useParams}}),a.o(n,"usePathname")&&a.d(t,{usePathname:function(){return n.usePathname}}),a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}})},5924:(e,t,a)=>{"use strict";a.d(t,{T:()=>m});var n=a(5155),s=a(2115),r=a(6298),i=a(3492),o=a(8839);class l{async connect(e,t){try{await this.disconnect(),this.client=new i.M(e,t),await this.client.connect(),await this.setupPaymentResponseSubscription(),console.log("Payment service connected to wallet")}catch(e){throw console.error("Failed to connect payment service:",e),this.client=null,e}}async setupPaymentResponseSubscription(){if(!this.client||!this.ndk)throw Error("Client or NDK not initialized");let e=this.client.getPublicKey?await this.client.getPublicKey():"";this.paymentSubscription=this.ndk.subscribe({kinds:[24133],"#p":[e]},{closeOnEose:!1}),this.paymentSubscription.on("event",async e=>{try{if(!this.client)return;let t=e.rawEvent();if(!t||"number"!=typeof t.kind){console.error("Invalid event received");return}let a=await this.client.processPaymentResponse(t);if(a&&a.id&&this.pendingPayments.has(a.id)){let e=this.pendingPayments.get(a.id);a.error?e.reject(Error("Payment error: ".concat(a.error.message))):a.result?e.resolve(a.result):e.reject(Error("Invalid payment response")),this.pendingPayments.delete(a.id)}}catch(e){console.error("Failed to process payment response event:",e)}}),console.log("Payment response subscription set up")}isConnected(){return null!==this.client}async getWalletInfo(){if(!this.client)throw Error("Not connected to a wallet");return await this.client.getInfo()}async getBalance(){if(!this.client)throw Error("Not connected to a wallet");return await this.client.getBalance()}async payInvoice(e){if(!this.client)throw Error("Not connected to a wallet");return await this.client.payInvoice(e)}async processPaymentEvent(e){if(!this.client||!this.ndk)throw Error("Not connected to a wallet");try{let t=await this.client.createPaymentRequestEvent(e),a=new Promise((a,n)=>{if(!t.id){n(Error("Invalid payment request event"));return}this.pendingPayments.set(t.id,{resolve:a,reject:n,invoice:e}),setTimeout(()=>{t.id&&this.pendingPayments.has(t.id)&&(this.pendingPayments.delete(t.id),n(Error("Payment timeout")))},6e4)}),n=new o.QB(this.ndk);return t.kind&&(n.kind=t.kind),n.tags=t.tags||[],n.content=t.content||"",n.created_at=t.created_at||Math.floor(Date.now()/1e3),await n.publish(),console.log("Payment request published, waiting for response..."),await a}catch(e){throw console.error("Failed to process payment:",e),e}}async disconnect(){for(let[e,{reject:t}]of(this.paymentSubscription&&(this.paymentSubscription.stop(),this.paymentSubscription=null),this.client&&(this.client.disconnect(),this.client=null),this.pendingPayments))t(Error("Disconnected from wallet")),this.pendingPayments.delete(e);console.log("Payment service disconnected")}constructor(e){this.client=null,this.paymentSubscription=null,this.pendingPayments=new Map,this.ndk=e}}let c=null,d=e=>(c||(c=new l(e)),c),m=e=>{let{invoice:t,amount:a,description:i,onSuccess:o,onError:l,onCancel:c}=e,{ndk:m,user:h,loginMethod:u}=(0,r.yX)(),[p,x]=(0,s.useState)("idle"),[g,y]=(0,s.useState)(null),[b,w]=(0,s.useState)(null),[f,k]=(0,s.useState)(!1),j="nip47"===u;(0,s.useEffect)(()=>{x("idle"),y(null),w(null)},[t]);let N=async()=>{if(!m||!h){y("You must be logged in to make a payment");return}try{if(x("connecting"),d(m),j||"nip07"===u){k(!0),x("idle");return}if("viewonly"===u)throw Error("Cannot make payments in view-only mode");throw Error("No compatible payment method detected")}catch(e){console.error("Failed to connect wallet:",e),y(e instanceof Error?e.message:"Failed to connect wallet"),x("error")}},v=async()=>{if(!m||!h){y("You must be logged in to make a payment");return}try{x("paying");let e=d(m);if(j){let a=await e.payInvoice(t);w(a.preimage),x("success"),null==o||o(a.preimage)}else if("nip07"===u){if(window.webln)try{await window.webln.enable();let e=await window.webln.sendPayment(t);w(e.preimage),x("success"),null==o||o(e.preimage)}catch(e){throw console.error("WebLN payment failed:",e),Error("WebLN payment failed. Please try again.")}else throw Error("Your browser extension does not support WebLN for payments")}else throw Error("No compatible payment method detected")}catch(e){console.error("Payment failed:",e),y(e instanceof Error?e.message:"Payment failed"),x("error"),null==l||l(e instanceof Error?e:Error("Payment failed"))}};return(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 max-w-md mx-auto",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-3 text-center dark:text-white",children:"Lightning Payment"}),(0,n.jsxs)("div",{className:"mb-4 text-center",children:[(0,n.jsxs)("p",{className:"text-2xl font-bold dark:text-white",children:[a," sats"]}),(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:i})]}),"error"===p&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-100 rounded",children:(0,n.jsx)("p",{children:g})}),"success"===p&&(0,n.jsxs)("div",{className:"mb-4 p-3 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-100 rounded",children:[(0,n.jsx)("p",{children:"Payment successful!"}),b&&(0,n.jsxs)("details",{className:"mt-2",children:[(0,n.jsx)("summary",{className:"cursor-pointer",children:"Payment Proof"}),(0,n.jsx)("p",{className:"text-xs mt-1 break-all",children:b})]})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[f||"success"===p?"success"!==p?(0,n.jsx)("button",{onClick:v,disabled:"paying"===p,className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm font-medium flex items-center justify-center disabled:opacity-50",children:"paying"===p?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"mr-2 animate-spin",children:"⚡"}),"Paying..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"mr-2",children:"⚡"}),"Pay with Nostr"]})}):null:(0,n.jsx)("button",{onClick:N,disabled:"connecting"===p,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium flex items-center justify-center disabled:opacity-50",children:"connecting"===p?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"mr-2 animate-spin",children:"⚡"}),"Connecting..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"mr-2",children:"⚡"}),"Connect Wallet"]})}),("idle"===p||"error"===p)&&(0,n.jsx)("button",{onClick:()=>{x("idle"),y(null),null==c||c()},className:"w-full px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-md text-sm font-medium",children:"Cancel"}),"success"===p&&(0,n.jsx)("button",{onClick:()=>{x("idle"),w(null)},className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium",children:"Done"})]}),(0,n.jsx)("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400 text-center",children:"Powered by Nostr + Lightning"})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[475,874,624,766,298,441,684,358],()=>t(5250)),_N_E=e.O()}]);
//# sourceMappingURL=page-e7fd0900acd5cbe2.js.map