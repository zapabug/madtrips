(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[348],{2778:(s,e,t)=>{Promise.resolve().then(t.bind(t,3150))},3150:(s,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>r});var i=t(5155),l=t(2115),a=t(6874),d=t.n(a);function r(){let[s,e]=(0,l.useState)(!0),[t,a]=(0,l.useState)(null),[r,n]=(0,l.useState)(null),[c,o]=(0,l.useState)({status:"pending",details:{}});(0,l.useEffect)(()=>{fetch("/api/diagnosis").then(s=>{if(!s.ok)throw Error("API returned status ".concat(s.status));return s.json()}).then(s=>{a(s),e(!1)}).catch(s=>{n(s.message),e(!1)}),u()},[]);let u=async()=>{let s={status:"checking",details:{}};if(s.details.d3Loaded="window.d3"in window,"undefined"!=typeof document){let e=document.querySelector(".visualization-container svg");if(s.details.svgExists=!!e,e){let t=e.getAttribute("width"),i=e.getAttribute("height");s.details.svgDimensions={width:t,height:i};let l=e.querySelectorAll(".node"),a=e.querySelectorAll(".link");s.details.nodeCount=l.length,s.details.linkCount=a.length}}try{let i=await fetch("/api/socialgraph");if(i.ok){var e,t;let l=await i.json();s.details.apiStatus="success",s.details.dataValid=!!(l&&l.nodes&&l.links),s.details.nodeCount=(null===(e=l.nodes)||void 0===e?void 0:e.length)||0,s.details.linkCount=(null===(t=l.links)||void 0===t?void 0:t.length)||0}else s.details.apiStatus="error",s.details.apiMessage="API returned status ".concat(i.status)}catch(e){s.details.apiStatus="error",s.details.apiMessage=e.message}"error"===s.details.apiStatus||s.details.svgExists&&!s.details.nodeCount?(s.status="error",s.message="Issues detected with client-side visualization"):s.details.svgExists?(s.status="success",s.message="Client-side checks passed"):(s.status="warning",s.message="SVG not found - visualization may not be rendering"),o(s)},h=s=>{switch(s){case"success":return"text-green-600";case"warning":return"text-yellow-600";case"error":return"text-red-600";default:return"text-gray-600"}};return(0,i.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Social Graph Diagnosis"}),s?(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto mb-4"}),(0,i.jsx)("p",{children:"Running diagnostics..."})]}):r?(0,i.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Error:"})," ",r]}),(0,i.jsx)("p",{className:"mt-2",children:"Please try again or check the server logs."})]}):(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"mb-8 flex gap-4 flex-wrap",children:[(0,i.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:()=>{let s=document.createElement("script");s.src="/diagnosis.js",document.body.appendChild(s),alert("Browser diagnostic script loaded. Check your browser console for results.")},children:"Run Browser Diagnostic"}),(0,i.jsx)(d(),{href:"/community",className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded inline-block",children:"View Social Graph"}),(0,i.jsx)(d(),{href:"/admin/socialgraph",className:"bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded inline-block",children:"Go to Admin Page"}),(0,i.jsx)(d(),{href:"/api/socialgraph?update=true",className:"bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded inline-block",children:"Force Graph Update"})]}),(0,i.jsxs)("div",{className:"bg-white shadow-md rounded p-6 mb-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Diagnosis Summary"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{className:"p-4 rounded ".concat("success"===t.results.api.status?"bg-green-100":"warning"===t.results.api.status?"bg-yellow-100":"bg-red-100"),children:[(0,i.jsx)("h3",{className:"font-medium",children:"API Status"}),(0,i.jsx)("p",{className:"".concat(h(t.results.api.status)),children:t.results.api.message})]}),(0,i.jsxs)("div",{className:"p-4 rounded ".concat("success"===t.results.files.status?"bg-green-100":"warning"===t.results.files.status?"bg-yellow-100":"bg-red-100"),children:[(0,i.jsx)("h3",{className:"font-medium",children:"Files Status"}),(0,i.jsx)("p",{className:"".concat(h(t.results.files.status)),children:t.results.files.message})]}),(0,i.jsxs)("div",{className:"p-4 rounded ".concat("success"===t.results.data.status?"bg-green-100":"warning"===t.results.data.status?"bg-yellow-100":"bg-red-100"),children:[(0,i.jsx)("h3",{className:"font-medium",children:"Data Status"}),(0,i.jsx)("p",{className:"".concat(h(t.results.data.status)),children:t.results.data.message})]})]})]}),(0,i.jsxs)("div",{className:"bg-white shadow-md rounded p-6 mb-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Client-side Diagnosis"}),(0,i.jsxs)("div",{className:"p-4 rounded ".concat("success"===c.status?"bg-green-100":"warning"===c.status?"bg-yellow-100":"bg-red-100"),children:[(0,i.jsx)("h3",{className:"font-medium",children:"Browser Status"}),(0,i.jsx)("p",{className:"".concat(h(c.status)),children:c.message||"Checking..."})]}),(0,i.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-medium mb-2",children:"API Check"}),(0,i.jsxs)("p",{children:["Status: ",c.details.apiStatus||"Unknown"]}),c.details.apiMessage&&(0,i.jsxs)("p",{children:["Message: ",c.details.apiMessage]}),void 0!==c.details.nodeCount&&(0,i.jsxs)("p",{children:["Nodes: ",c.details.nodeCount]}),void 0!==c.details.linkCount&&(0,i.jsxs)("p",{children:["Links: ",c.details.linkCount]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-medium mb-2",children:"SVG Check"}),(0,i.jsxs)("p",{children:["SVG Exists: ",c.details.svgExists?"Yes":"No"]}),c.details.svgDimensions&&(0,i.jsxs)("p",{children:["Dimensions: ",c.details.svgDimensions.width," x ",c.details.svgDimensions.height]}),void 0!==c.details.nodeCount&&(0,i.jsxs)("p",{children:["Rendered Nodes: ",c.details.nodeCount]}),void 0!==c.details.linkCount&&(0,i.jsxs)("p",{children:["Rendered Links: ",c.details.linkCount]})]})]})]}),(0,i.jsxs)("div",{className:"bg-white shadow-md rounded p-6 mb-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Recommendations"}),(0,i.jsx)("ul",{className:"list-disc pl-5 space-y-2",children:t.recommendations.map((s,e)=>(0,i.jsx)("li",{children:s},e))})]}),t.results.files.details&&(0,i.jsxs)("div",{className:"bg-white shadow-md rounded p-6 mb-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"File System Details"}),(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"min-w-full bg-white",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"Property"}),(0,i.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"Value"})]})}),(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:"Data Directory"}),(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:t.results.files.details.directoryExists?"Exists":"Missing"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:"social-graph.json"}),(0,i.jsxs)("td",{className:"py-2 px-4 border-b",children:[t.results.files.details.socialGraphExists?"Exists":"Missing"," ",!1===t.results.files.details.socialGraphValid&&"(Invalid JSON)"]})]}),t.results.files.details.socialGraphExists&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:"File Size"}),(0,i.jsxs)("td",{className:"py-2 px-4 border-b",children:[Math.round(t.results.files.details.socialGraphSize/1024)," KB"]})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:"Last Modified"}),(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:new Date(t.results.files.details.socialGraphModified).toLocaleString()})]}),t.results.files.details.socialGraphValid&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:"Nodes Count"}),(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:t.results.files.details.nodesCount})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:"Links Count"}),(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:t.results.files.details.linksCount})]})]})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:"known-pubkeys.json"}),(0,i.jsxs)("td",{className:"py-2 px-4 border-b",children:[t.results.files.details.knownPubkeysExists?"Exists":"Missing"," ",!1===t.results.files.details.knownPubkeysValid&&"(Invalid JSON)"]})]}),t.results.files.details.knownPubkeysExists&&t.results.files.details.knownPubkeysValid&&(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:"Pubkeys Count"}),(0,i.jsx)("td",{className:"py-2 px-4 border-b",children:t.results.files.details.pubkeysCount})]})]})]})})]}),t.results.data.details&&t.results.data.details.sampleNodes&&(0,i.jsxs)("div",{className:"bg-white shadow-md rounded p-6 mb-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Data Sample"}),(0,i.jsx)("h3",{className:"font-medium mb-2",children:"Node Type Distribution"}),t.results.data.details.nodeTypeDistribution&&(0,i.jsx)("ul",{className:"list-disc pl-5 mb-4",children:Object.entries(t.results.data.details.nodeTypeDistribution).map(s=>{let[e,t]=s;return(0,i.jsxs)("li",{children:[e,": ",t]},e)})}),(0,i.jsx)("h3",{className:"font-medium mb-2",children:"Sample Nodes (First 3)"}),(0,i.jsx)("pre",{className:"bg-gray-100 p-4 rounded overflow-x-auto text-xs",children:JSON.stringify(t.results.data.details.sampleNodes,null,2)})]}),(0,i.jsxs)("details",{className:"bg-white shadow-md rounded p-6 mb-6",children:[(0,i.jsx)("summary",{className:"text-xl font-semibold cursor-pointer",children:"Raw Diagnostic Data"}),(0,i.jsx)("pre",{className:"mt-4 bg-gray-100 p-4 rounded overflow-x-auto text-xs h-64",children:JSON.stringify(t,null,2)})]})]})]})}}},s=>{var e=e=>s(s.s=e);s.O(0,[874,441,684,358],()=>e(2778)),_N_E=s.O()}]);
//# sourceMappingURL=page-3db4c165dd6f80f4.js.map