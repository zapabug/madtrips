(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[88],{998:(e,t,n)=>{Promise.resolve().then(n.bind(n,9410))},5924:(e,t,n)=>{"use strict";n.d(t,{T:()=>m});var r=n(5155),s=n(2115),a=n(6298),i=n(3492),l=n(8839);class o{async connect(e,t){try{await this.disconnect(),this.client=new i.M(e,t),await this.client.connect(),await this.setupPaymentResponseSubscription(),console.log("Payment service connected to wallet")}catch(e){throw console.error("Failed to connect payment service:",e),this.client=null,e}}async setupPaymentResponseSubscription(){if(!this.client||!this.ndk)throw Error("Client or NDK not initialized");let e=this.client.getPublicKey?await this.client.getPublicKey():"";this.paymentSubscription=this.ndk.subscribe({kinds:[24133],"#p":[e]},{closeOnEose:!1}),this.paymentSubscription.on("event",async e=>{try{if(!this.client)return;let t=e.rawEvent();if(!t||"number"!=typeof t.kind){console.error("Invalid event received");return}let n=await this.client.processPaymentResponse(t);if(n&&n.id&&this.pendingPayments.has(n.id)){let e=this.pendingPayments.get(n.id);n.error?e.reject(Error("Payment error: ".concat(n.error.message))):n.result?e.resolve(n.result):e.reject(Error("Invalid payment response")),this.pendingPayments.delete(n.id)}}catch(e){console.error("Failed to process payment response event:",e)}}),console.log("Payment response subscription set up")}isConnected(){return null!==this.client}async getWalletInfo(){if(!this.client)throw Error("Not connected to a wallet");return await this.client.getInfo()}async getBalance(){if(!this.client)throw Error("Not connected to a wallet");return await this.client.getBalance()}async payInvoice(e){if(!this.client)throw Error("Not connected to a wallet");return await this.client.payInvoice(e)}async processPaymentEvent(e){if(!this.client||!this.ndk)throw Error("Not connected to a wallet");try{let t=await this.client.createPaymentRequestEvent(e),n=new Promise((n,r)=>{if(!t.id){r(Error("Invalid payment request event"));return}this.pendingPayments.set(t.id,{resolve:n,reject:r,invoice:e}),setTimeout(()=>{t.id&&this.pendingPayments.has(t.id)&&(this.pendingPayments.delete(t.id),r(Error("Payment timeout")))},6e4)}),r=new l.QB(this.ndk);return t.kind&&(r.kind=t.kind),r.tags=t.tags||[],r.content=t.content||"",r.created_at=t.created_at||Math.floor(Date.now()/1e3),await r.publish(),console.log("Payment request published, waiting for response..."),await n}catch(e){throw console.error("Failed to process payment:",e),e}}async disconnect(){for(let[e,{reject:t}]of(this.paymentSubscription&&(this.paymentSubscription.stop(),this.paymentSubscription=null),this.client&&(this.client.disconnect(),this.client=null),this.pendingPayments))t(Error("Disconnected from wallet")),this.pendingPayments.delete(e);console.log("Payment service disconnected")}constructor(e){this.client=null,this.paymentSubscription=null,this.pendingPayments=new Map,this.ndk=e}}let d=null,c=e=>(d||(d=new o(e)),d),m=e=>{let{invoice:t,amount:n,description:i,onSuccess:l,onError:o,onCancel:d}=e,{ndk:m,user:g,loginMethod:h}=(0,a.yX)(),[u,y]=(0,s.useState)("idle"),[p,x]=(0,s.useState)(null),[b,w]=(0,s.useState)(null),[f,k]=(0,s.useState)(!1),j="nip47"===h;(0,s.useEffect)(()=>{y("idle"),x(null),w(null)},[t]);let v=async()=>{if(!m||!g){x("You must be logged in to make a payment");return}try{if(y("connecting"),c(m),j||"nip07"===h){k(!0),y("idle");return}if("viewonly"===h)throw Error("Cannot make payments in view-only mode");throw Error("No compatible payment method detected")}catch(e){console.error("Failed to connect wallet:",e),x(e instanceof Error?e.message:"Failed to connect wallet"),y("error")}},N=async()=>{if(!m||!g){x("You must be logged in to make a payment");return}try{y("paying");let e=c(m);if(j){let n=await e.payInvoice(t);w(n.preimage),y("success"),null==l||l(n.preimage)}else if("nip07"===h){if(window.webln)try{await window.webln.enable();let e=await window.webln.sendPayment(t);w(e.preimage),y("success"),null==l||l(e.preimage)}catch(e){throw console.error("WebLN payment failed:",e),Error("WebLN payment failed. Please try again.")}else throw Error("Your browser extension does not support WebLN for payments")}else throw Error("No compatible payment method detected")}catch(e){console.error("Payment failed:",e),x(e instanceof Error?e.message:"Payment failed"),y("error"),null==o||o(e instanceof Error?e:Error("Payment failed"))}};return(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 max-w-md mx-auto",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-3 text-center dark:text-white",children:"Lightning Payment"}),(0,r.jsxs)("div",{className:"mb-4 text-center",children:[(0,r.jsxs)("p",{className:"text-2xl font-bold dark:text-white",children:[n," sats"]}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:i})]}),"error"===u&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-100 rounded",children:(0,r.jsx)("p",{children:p})}),"success"===u&&(0,r.jsxs)("div",{className:"mb-4 p-3 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-100 rounded",children:[(0,r.jsx)("p",{children:"Payment successful!"}),b&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer",children:"Payment Proof"}),(0,r.jsx)("p",{className:"text-xs mt-1 break-all",children:b})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[f||"success"===u?"success"!==u?(0,r.jsx)("button",{onClick:N,disabled:"paying"===u,className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm font-medium flex items-center justify-center disabled:opacity-50",children:"paying"===u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"mr-2 animate-spin",children:"⚡"}),"Paying..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"mr-2",children:"⚡"}),"Pay with Nostr"]})}):null:(0,r.jsx)("button",{onClick:v,disabled:"connecting"===u,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium flex items-center justify-center disabled:opacity-50",children:"connecting"===u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"mr-2 animate-spin",children:"⚡"}),"Connecting..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"mr-2",children:"⚡"}),"Connect Wallet"]})}),("idle"===u||"error"===u)&&(0,r.jsx)("button",{onClick:()=>{y("idle"),x(null),null==d||d()},className:"w-full px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-md text-sm font-medium",children:"Cancel"}),"success"===u&&(0,r.jsx)("button",{onClick:()=>{y("idle"),w(null)},className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium",children:"Done"})]}),(0,r.jsx)("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400 text-center",children:"Powered by Nostr + Lightning"})]})}},9410:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n(5155),s=n(2115),a=n(6298),i=n(5924);function l(){let{user:e,loginMethod:t}=(0,a.yX)(),[n,l]=(0,s.useState)(""),[o,d]=(0,s.useState)("1000"),[c,m]=(0,s.useState)("Test Payment"),[g,h]=(0,s.useState)(!1),[u,y]=(0,s.useState)(null),p=()=>{let e="lnbc10m1pvjluezpp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqdpl2pkx2ctnv5sxxmmwwd5kgetjypeh2ursdae8g6twvus8g6rfwvs8qun0dfjkxaqnqsfcq0d4jq3n3q0jaunt4qz7zs0gyaqyfz8yrtfd6cm9a3t3kxzwfjuj3hxxecpda9qxdhp8p0nyumz2vzjzle60e4g9ekrdffr9znscdhvugz";return l(e),e};return(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Nostr Payment Example"}),e?"viewonly"===t?(0,r.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900 border border-yellow-400 dark:border-yellow-700 text-yellow-800 dark:text-yellow-100 p-4 rounded mb-6",children:[(0,r.jsx)("p",{className:"font-medium",children:"You are in view-only mode."}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"Please log in with a NIP-07 extension or NIP-47 remote signer to test payments."})]}):(0,r.jsxs)("div",{className:"bg-green-100 dark:bg-green-900 border border-green-400 dark:border-green-700 text-green-800 dark:text-green-100 p-4 rounded mb-6",children:[(0,r.jsxs)("p",{className:"font-medium",children:["You are logged in with ","nip07"===t?"a browser extension":"a remote signer","."]}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"You can now test the payment functionality."})]}):(0,r.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900 border border-yellow-400 dark:border-yellow-700 text-yellow-800 dark:text-yellow-100 p-4 rounded mb-6",children:[(0,r.jsx)("p",{className:"font-medium",children:"Please log in to test the payment functionality."}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"Use the Nostr login button in the bottom right corner."})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Payment Configuration"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount (sats)"}),(0,r.jsx)("input",{type:"number",id:"amount",value:o,onChange:e=>d(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"Enter amount in satoshis"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),(0,r.jsx)("input",{type:"text",id:"description",value:c,onChange:e=>m(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"Enter payment description"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"invoice",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Lightning Invoice (optional)"}),(0,r.jsx)("textarea",{id:"invoice",value:n,onChange:e=>l(e.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"Enter a Lightning invoice or leave empty to generate a demo one"}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"If left empty, a fake invoice will be generated for demonstration."})]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{onClick:()=>{n||p(),h(!0),y(null)},disabled:!e||"viewonly"===t,className:"w-full px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Start Payment Demo"})})]})]}),u&&(0,r.jsx)("div",{className:"mb-6 p-4 rounded ".concat(u.includes("failed")?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-100":"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100"),children:(0,r.jsx)("p",{children:u})}),g&&(0,r.jsx)("div",{className:"mt-8",children:(0,r.jsx)(i.T,{invoice:n,amount:o,description:c,onSuccess:e=>{console.log("Payment successful with preimage:",e),y("Payment successful! Preimage: ".concat(e.substring(0,8),"..."))},onError:e=>{console.error("Payment failed:",e),y("Payment failed: ".concat(e.message))},onCancel:()=>{console.log("Payment cancelled"),h(!1)}})}),(0,r.jsxs)("div",{className:"mt-8 bg-gray-100 dark:bg-gray-700 p-4 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"How It Works"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"This example demonstrates how to integrate Nostr-based Lightning payments into your application:"}),(0,r.jsxs)("ol",{className:"list-decimal list-inside text-sm text-gray-600 dark:text-gray-300 space-y-1 ml-2",children:[(0,r.jsx)("li",{children:"User logs in with a Nostr wallet (NIP-07 extension or NIP-47 remote signer)"}),(0,r.jsx)("li",{children:"Application generates a Lightning invoice"}),(0,r.jsx)("li",{children:"Payment component connects to the user's wallet"}),(0,r.jsx)("li",{children:"User confirms the payment in their wallet"}),(0,r.jsx)("li",{children:"Application verifies the payment and updates the UI"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-4",children:"In a real application, you would integrate with a Lightning service to generate valid invoices and verify payments."})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[475,624,298,441,684,358],()=>t(998)),_N_E=e.O()}]);
//# sourceMappingURL=page-152da0733493f86d.js.map